{"code":"!function(t){var e={};function i(l){if(e[l])return e[l].exports;var o=e[l]={i:l,l:!1,exports:{}};return t[l].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,l){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:l})},i.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var l=Object.create(null);if(i.r(l),Object.defineProperty(l,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var o in t)i.d(l,o,function(e){return t[e]}.bind(null,o));return l},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,\"a\",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p=\"\",i(i.s=0)}([function(t,e,i){\"use strict\";i.r(e);class l{static create(t,e){const i=[];for(;e--;)i.push(new Array(t).fill(0));return i}static clone(t){let e=t.slice(0);for(let i=0;i<t[0].length;i++)e[i]=t[i].slice(0);return e}static merge(t,e,i){let l=this.clone(t);return e.forEach((t,e)=>{t.forEach((t,o)=>{console.log(t),0!==t&&void 0!==t&&(l[i.y+e][i.x+o]=t)})}),l}static rotate(t,e){const i=l.create(t.length,t[0].length),o=t[0].length,n=t.length;for(let e=0;e<n;e++)for(let l=0;l<o;l++){let r=t[l][e];i[l][e]=t[e][o-1-l],i[e][n-1-l]=t[o-1-l][n-1-e],i[o-1-l][n-1-e]=t[n-1-e][l],i[n-1-e][l]=r}return i}static draw(t,e,i,l){const o=[\"null\",\"Red\",\"Blue\",\"Green\",\"Yellow\",\"Purple\",\"Black\"];e.forEach((e,n)=>{e.forEach((e,r)=>{0!==e&&(t.fillStyle=\"Black\",t.fillRect((i.x+r)*l+1,(i.y+n)*l+1,l-1,l-1),t.fillStyle=\"white\",t.fillRect((i.x+r)*l,(i.y+n)*l,l-1,l-1),t.fillStyle=o[e],t.fillRect((i.x+r)*l+1,(i.y+n)*l+1,l-2,l-2))})})}}const o=document.getElementById(\"tetris\"),n=o.getContext(\"2d\"),r=document.getElementById(\"score\"),s=r.getContext(\"2d\"),c=document.getElementById(\"next_piece\"),h=c.getContext(\"2d\"),a=Math.floor(10*Math.min(window.innerHeight/400,document.documentElement.clientHeight/400,window.innerWidth/280,document.documentElement.clientWidth/280))/10;window.innerHeight>window.innerWidth&&(document.getElementById(\"tetris\").style.display=\"block\",document.getElementById(\"score\").style.display=\"inline-block\",document.getElementById(\"next_piece\").style.display=\"inline-block\"),console.log(a);const u=20*a;n.scale(a,a),o.width=o.width*a,o.height=o.height*a,s.scale(a,a),r.width=r.width*a,r.height=r.height*a,c.width=c.width*a,c.height=c.height*a;let d=null,f=0,x=null,g=0,m=1e3,w=0;const y=new class{constructor(t,e){this.gameMatrix=l.create(12,20)}clearGameMatrix(){this.gameMatrix.forEach(t=>t.fill(0))}setMatrix(t){this.gameMatrix=t}removeWholeRows(t){const e=this.gameMatrix;let i=1;for(let l=e.length-1;l>=0;l--){let o=!0;for(let t=0;t<e[0].length;t++)0===e[l][t]&&(o=!1);!0===o&&(e.splice(l,1),e.unshift(new Array(e[0].length).fill(0)),l++,t+=10*i,i*=2)}return t}}(12,20),p=new class{constructor(t,e){this.widthX=6*e,this.heightY=10*e,this.blockSize=e,this.context=t}drawGameScore(t){this.context.fillStyle=\"Black\",this.context.fillRect(0*this.blockSize,1*this.blockSize,6*this.blockSize,3*this.blockSize),this.context.font=`${this.blockSize}px Arial`,this.context.fillStyle=\"White\",this.context.fillText(t,3*this.blockSize-this.context.measureText(t).width/2|0,3*this.blockSize)}draw(t){const e=this.blockSize;this.context.fillStyle=\"Black\";for(let t=0;t<this.heightY/e;t++)for(let i=0;i<this.widthX/e;i++)this.context.fillStyle=\"Black\",this.context.fillRect(i*e+1,t*e+1,e-1,e-1),this.context.fillStyle=\"white\",this.context.fillRect(i*e,t*e,e-1,e-1),this.context.fillStyle=\"Grey\",this.context.fillRect(i*e+1,t*e+1,e-2,e-2);this.drawGameScore(t)}}(s,u),S=new class{constructor(t,e){this.widthX=6*e,this.heightY=10*e,this.blockSize=e,this.context=t}drawNextPiece(t){this.nextPiece=t,this.context.fillStyle=\"Black\",this.context.fillRect(0*this.blockSize,1*this.blockSize,6*this.blockSize,6*this.blockSize),l.draw(this.context,t,{x:2,y:2},this.blockSize)}draw(t){const e=this.blockSize;this.context.fillStyle=\"Black\";for(let t=0;t<this.heightY/e;t++)for(let i=0;i<this.widthX/e;i++)this.context.fillStyle=\"Black\",this.context.fillRect(i*e+1,t*e+1,e-1,e-1),this.context.fillStyle=\"white\",this.context.fillRect(i*e,t*e,e-1,e-1),this.context.fillStyle=\"Grey\",this.context.fillRect(i*e+1,t*e+1,e-2,e-2);this.drawNextPiece(t)}}(h,u),v=new class{constructor(t){this.matrix=t,this.pos={x:0,y:0},this.matrix=null,this.pieces={T:[[0,0,0],[1,1,1],[0,1,0]],L:[[0,2,0],[0,2,0],[0,2,2]],B:[[3,3],[3,3]],I:[[0,4,0,0],[0,4,0,0],[0,4,0,0],[0,4,0,0]],S:[[0,0,0],[0,5,5],[5,5,0]],J:[[0,0,2],[0,0,2],[0,2,2]],Z:[[0,0,0],[5,5,0],[0,5,5]]}}gravity(){return this.pos.y++,0}create(t){return this.pieces[t]}next(t,e){return null===e&&(e=this.create(\"SZILJBT\"[Math.floor(\"SZILJBT\".length*Math.random())])),this.matrix=e,e=this.create(\"SZILJBT\"[Math.floor(\"SZILJBT\".length*Math.random())]),this.pos.y=0,this.pos.x=Math.floor(t/2)-Math.floor(this.matrix[0].length/2),e}isACollision(t){const{matrix:e,pos:i}=this;for(let l=0;l<e.length;l++)for(let o=0;o<e[l].length;o++)if(0!==e[l][o]&&0!==(t[i.y+l]&&t[i.y+l][i.x+o]))return!0;return!1}move(t,e){this.pos.x+=e,this.isACollision(t,this)&&(console.log(this.pos.x),this.pos.x-=e)}rotate(t,e){const i=this.pos.x;let o=1;for(this.matrix=l.rotate(this.matrix,e);this.isACollision(t,this);)if(this.pos.x+=o,(o=-(o+1))>this.matrix[0].length)return this.matrix=this.rotate(this.matrix,-e),void(this.pos.x=i)}};function b(t){const e=y.gameMatrix,i={ArrowRight:()=>v.move(e,1),ArrowLeft:()=>v.move(e,-1),ArrowDown:()=>g=v.gravity(),ArrowUp:()=>v.rotate(e,1)};i[t]&&i[t]()}function k(t,e,i,l,o,n){return Math.abs((t*(l-n)+i*(n-e)+o*(e-l))/2)}function M([t,e],[i,l],[o,n],[r,s]){return k(t,e,i,l,o,n)==k(r,s,i,l,o,n)+k(t,e,r,s,o,n)+k(t,e,i,l,r,s)}function B(t,e){let i=v.pos.x*u+40,l=v.pos.y*u+40,n=null;M([o.width,0],[i,l],[o.width,o.height],[t,e])?n=\"ArrowRight\":M([0,0],[i,l],[0,o.height],[t,e])?n=\"ArrowLeft\":M([0,0],[i,l],[o.width,0],[t,e])?n=\"ArrowUp\":M([0,o.height],[i,l],[o.width,o.height],[t,e])&&(n=\"ArrowDown\"),b(n),null!==x&&clearInterval(x),null!==n&&(x=setInterval(function(){b(n)},\"ArrowUp\"===n?200:100))}console.log(v),d=v.next(y.gameMatrix[0].length,d),document.addEventListener(\"keydown\",t=>{console.log(t.code),b(t.code)}),o.addEventListener(\"mousedown\",t=>{console.log(\"mousedown\"),t.preventDefault(),B(t.clientX,t.clientY)}),o.addEventListener(\"touchstart\",t=>{console.log(\"touchstart\"),t.preventDefault(),B(t.changedTouches[0].clientX,t.changedTouches[0].clientY)}),o.addEventListener(\"mouseup\",t=>{console.log(\"mouseup\"),t.preventDefault(),null!==x&&clearInterval(x),x=null}),o.addEventListener(\"touchend\",t=>{console.log(\"mouseend\"),t.preventDefault(),null!==x&&clearInterval(x),x=null}),o.addEventListener(\"mouseleave\",t=>{null!==x&&clearInterval(x),x=null}),function t(e=0){const i=e-w;w=e,(g+=i)>m&&(g=v.gravity()),v.isACollision(y.gameMatrix,v)&&(v.pos.y--,y.setMatrix(l.merge(y.gameMatrix,v.matrix,v.pos)),null!==x&&(clearInterval(x),x=null),f=y.removeWholeRows(f),d=v.next(y.gameMatrix[0].length,d)),function(){const t=y.gameMatrix;return!!v.isACollision(t,v)}()&&(y.clearGameMatrix(),f=0),function(){const t=y.gameMatrix;n.fillStyle=\"#000\",n.fillRect(0,0,o.width,o.height),l.draw(n,v.matrix,v.pos,u),l.draw(n,t,{x:0,y:0},u),p.draw(f),S.draw(d)}(),requestAnimationFrame(t)}()}]);","extractedComments":[]}